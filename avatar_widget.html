<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>DYN201 Avatar</title>
  <style>
    body { margin: 0; background: #111; color: white; }
    #canvas-container { width: 100%; height: 70%; }
    #speak-btn { width: 100%; padding: 10px; margin-top: 10px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/wawa-lipsync/dist/wawa-lipsync.umd.js"></script> <!-- opsiyonel --> <!-- :contentReference[oaicite:12]{index=12} -->
  <script src="https://cdn.jsdelivr.net/gh/met4citizen/TalkingHead/dist/TalkingHead.min.js"></script> <!-- :contentReference[oaicite:13]{index=13} -->
</head>
<body>
  <div id="canvas-container"></div>
  <button id="speak-btn">Avatar konuşsun</button>

  <script>
    const textToSpeak = `{{ANSWER_PLACEHOLDER}}`;

    // 1) TalkingHead 3D avatarı başlat
    const container = document.getElementById('canvas-container');
    const avatar = new TalkingHead.TalkingHead({
      container,
      avatarUrl: 'PATH/TO/ready-player-me-avatar.glb', // ücretsiz bir RPM avatarı kullan :contentReference[oaicite:14]{index=14}
      autoRotate: true
    });

    // 2) Web Speech API ile TTS
    function speak(text) {
      if (!text || !window.speechSynthesis) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-US';
      // Ses oynarken ses örneklerini almak için:
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const src = audioCtx.createMediaStreamDestination();
      // Basit yol: wawa-lipsync yerine, TalkingHead'in built-in audio analizini kullan
      // Eğer wawa-lipsync entegrasyonu yaparsan, buradan audio verisini ona da verirsin

      utter.onstart = () => {
        // Avatar konuşma animasyonu başlat
        avatar.startSpeaking(); // TalkingHead dokümantasyonunda karşılığı var
      };
      utter.onend = () => {
        avatar.stopSpeaking();
        audioCtx.close();
      };

      window.speechSynthesis.speak(utter);
    }

    document.getElementById('speak-btn').addEventListener('click', () => {
      speak(textToSpeak);
    });
  </script>
</body>
</html>
